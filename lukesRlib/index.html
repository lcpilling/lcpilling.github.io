<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="My library of R functions I sometimes find useful. Some shamelessly borrowed from other packages and the internet generally.">
<title>My library of R functions I sometimes find useful • lukesRlib</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="My library of R functions I sometimes find useful">
<meta property="og:description" content="My library of R functions I sometimes find useful. Some shamelessly borrowed from other packages and the internet generally.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">lukesRlib</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.5.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lukepilling/lukesRlib/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><p><img align="right" src="https://github.com/lukepilling/lukesRlib/raw/master/images/lukesRlib.png" width="200"></p>
<div class="section level1">
<div class="page-header"><h1 id="lukesrlib">lukesRlib<a class="anchor" aria-label="anchor" href="#lukesrlib"></a>
</h1></div>
<p>My library of R functions I sometimes find useful</p>
<!-- badges: start -->

<p><sub>Toolbox icon from <a href="https://vectorified.com/icon-tool-box" class="external-link uri">https://vectorified.com/icon-tool-box</a></sub></p>
<div class="section level2">
<h2 id="list-of-functions">List of functions<a class="anchor" aria-label="anchor" href="#list-of-functions"></a>
</h2>
<ul>
<li>
<a href="#hypothesis-testing">Hypothesis testing</a>
<ul>
<li><a href="#tidy_ci">tidy_ci()</a></li>
<li><a href="#get_assoc">get_assoc()</a></li>
</ul>
</li>
<li>
<a href="#data-transformation">Data Transformation</a>
<ul>
<li><a href="#carrec">carrec()</a></li>
<li><a href="#inv_norm">inv_norm()</a></li>
<li><a href="#z_trans">z_trans()</a></li>
</ul>
</li>
<li>
<a href="#working-with-test-statistics">Working with test statistics</a>
<ul>
<li>
<a href="#get_se">get_se()</a>, <a href="#get_z">get_z()</a>, <a href="#get_p">get_p()</a>
</li>
<li>
<a href="#get_p_extreme">get_p_extreme()</a>, <a href="#get_p_neglog10">get_p_neglog10()</a>, <a href="#get_p_neglog10_n">get_p_neglog10_n()</a>
</li>
</ul>
</li>
<li>
<a href="#plotting-related">Plotting-related</a>
<ul>
<li><a href="#annotate_textp">annotate_textp()</a></li>
<li><a href="#theme_minimal_modified">theme_minimal_modified()</a></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>To install the development version from GitHub use the <code>remotes</code> package:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"lukepilling/lukesRlib"</span><span class="op">)</span></span></code></pre></div>
<p>I periodically “release” a version number once it works as expected. The development version may contain things that do not yet “work”</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># To install the latest release, use:</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"lukepilling/lukesRlib@*release"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To install a specific version (see tags), use:</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"lukepilling/lukesRlib@v0.2.0"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="hypothesis-testing">Hypothesis testing<a class="anchor" aria-label="anchor" href="#hypothesis-testing"></a>
</h2>
<div class="section level3">
<h3 id="tidy_ci">tidy_ci()<a class="anchor" aria-label="anchor" href="#tidy_ci"></a>
</h3>
<p><code><a href="reference/tidy_ci.html">tidy_ci()</a></code> (“tidy with CIs”) runs <a href="https://broom.tidymodels.org/" class="external-link"><code>broom::tidy()</code></a> and returns the tidy estimates with CIs calculated as EST +/- 1.96*SE</p>
<p>Motivation: by default the <a href="https://broom.tidymodels.org/" class="external-link">{broom}</a> package uses <code><a href="https://rdrr.io/r/stats/confint.html" class="external-link">confint()</a></code> to estimate CIs. For GLMs this calculates CIs via the profile likelihood method. When using large datasets this takes a long time and does not meaningfully alter the CIs compared to calculating using 1.96*SE</p>
<p><code><a href="reference/tidy_ci.html">tidy_ci()</a></code> does a few other nice things: hides the intercept by default, automatically detects logistic/CoxPH/CRR models and exponentiates the estimates, and if p==0 returns the ‘extreme p’ as a string. Other options include -log10 p-values. See the <a href="https://github.com/lukepilling/lukesRlib/wiki/tidy_ci()" class="external-link"><code>tidy_ci()</code> Wiki</a> page for more details</p>
<div class="section level4">
<h4 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_linear</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">bmi</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/tidy_ci.html">tidy_ci</a></span><span class="op">(</span><span class="va">fit_linear</span><span class="op">)</span></span>
<span><span class="co">#&gt; Linear model (estimate=coefficient) :: N=449811 :: R2=0.0099</span></span>
<span><span class="co">#&gt; # A tibble: 2 x 8</span></span>
<span><span class="co">#&gt;   term  estimate std.error statistic   p.value conf.low conf.high p.extreme</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;    </span></span>
<span><span class="co">#&gt; 1 age     0.0196  0.000847     23.1  4.72e-118   0.0179    0.0212 NA       </span></span>
<span><span class="co">#&gt; 2 sex     0.703   0.0137       51.4  0           0.676     0.729  9.39e-576</span></span></code></pre></div>
<p>Provided N and R^2 estimate. Calculated “extreme p” where p rounded to 0</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="va">fit_coxph</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/survival/man/coxph.html" class="external-link">coxph</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/survival/man/Surv.html" class="external-link">Surv</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">status</span><span class="op">)</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">smoking_status</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/tidy_ci.html">tidy_ci</a></span><span class="op">(</span><span class="va">fit_coxph</span><span class="op">)</span></span>
<span><span class="co">#&gt; CoxPH model (estimate=Hazard Ratio) :: N=449811, Nevents=31025</span></span>
<span><span class="co">#&gt; # A tibble: 4 x 8</span></span>
<span><span class="co">#&gt;   term             estimate std.error statistic  p.value conf.low conf.high</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span><span class="co">#&gt; 1 age                 0.995  0.000837     -6.56 5.28e-11    0.993     0.996</span></span>
<span><span class="co">#&gt; 2 sex                 1.04   0.0109        3.66 2.52e- 4    1.02      1.06 </span></span>
<span><span class="co">#&gt; 3 smoking_status-1    1.04   0.0120        3.26 1.13e- 3    1.02      1.06 </span></span>
<span><span class="co">#&gt; 4 smoking_status-2    1.03   0.0149        2.16 3.08e- 2    1.00      1.06 </span></span></code></pre></div>
<p>Automatically identified the input as from a coxph model and exponentiated estimate/CIs. Also provided N and Nevents. Also, tidied “as.factor()” variable names.</p>
</div>
</div>
<div class="section level3">
<h3 id="get_assoc">get_assoc()<a class="anchor" aria-label="anchor" href="#get_assoc"></a>
</h3>
<p><code><a href="reference/get_assoc.html">get_assoc()</a></code> (phonetically: “get-a-sock”) makes PheWAS in R easy and fast, utilizing the {purrr} <code><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2()</a></code> function. It gets the tidy model output for categorical or continuous exposures, from linear, logistic, or CoxPH models: includes N and N cases, outcome, and model info. User can provide multiples exposures and outcomes.</p>
<p>See the <a href="https://github.com/lukepilling/lukesRlib/wiki/get_assoc()" class="external-link"><code>get_assoc()</code> Wiki</a> details</p>
<div class="section level4">
<h4 id="examples-1">Examples<a class="anchor" aria-label="anchor" href="#examples-1"></a>
</h4>
<div class="section level5">
<h5 id="get-tidy-model-output-for-an-exposureoutcome-combination">Get tidy model output for an exposure/outcome combination<a class="anchor" aria-label="anchor" href="#get-tidy-model-output-for-an-exposureoutcome-combination"></a>
</h5>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_assoc.html">get_assoc</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"height"</span>, y<span class="op">=</span><span class="st">"weight"</span>, z<span class="op">=</span><span class="st">"+age+sex"</span>, d<span class="op">=</span><span class="va">ukb</span><span class="op">)</span></span>
<span><span class="co">#&gt; A tibble: 1 x 10</span></span>
<span><span class="co">#&gt;   outcome exposure estimate std.error statistic   p.value conf.low conf.high     n model</span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 weight  height      0.762    0.0296      25.7 3.36e-137    0.704     0.820  4981 lm</span></span></code></pre></div>
<p>The above example is equivalent to <code>tidy_ci(glm(weight~height+age+sex, data=ukb))</code> with added <code>n</code></p>
</div>
<div class="section level5">
<h5 id="categorical-exposure-in-logistic-regression---stratified-analysis">Categorical exposure in logistic regression - stratified analysis<a class="anchor" aria-label="anchor" href="#categorical-exposure-in-logistic-regression---stratified-analysis"></a>
</h5>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/get_assoc.html">get_assoc</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"smoking_status"</span>, y<span class="op">=</span><span class="st">"chd"</span>, z<span class="op">=</span><span class="st">"+age"</span>, d<span class="op">=</span><span class="va">ukb</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span>, model<span class="op">=</span><span class="st">"logistic"</span>, af<span class="op">=</span><span class="cn">TRUE</span>, note<span class="op">=</span><span class="st">"Males"</span><span class="op">)</span></span>
<span><span class="co">#&gt; A tibble: 3 x 12</span></span>
<span><span class="co">#&gt;   outcome exposure         estimate std.error statistic p.value conf.low conf.high     n n_cases model    note </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 chd     smoking_status-0    NA       NA         NA    NA        NA         NA     1073     146 logistic Males</span></span>
<span><span class="co">#&gt; 2 chd     smoking_status-1     1.24     0.126      1.72  0.0852    0.970      1.59   918     180 logistic Males</span></span>
<span><span class="co">#&gt; 3 chd     smoking_status-2     1.48     0.181      2.16  0.0311    1.04       2.11   285      52 logistic Males</span></span></code></pre></div>
<p>In the above example, the <code>estimate</code> is the Odds Ratio from a logistic regression model. The <code>n</code> and <code>n_cases</code> are directly from the model object and reflect those included in the model after excluding missing participants. The exposure is categorical, and a reference category line has been added to include the N and Ncases for that group.</p>
</div>
<div class="section level5">
<h5 id="multiple-exposures-on-single-outcome-ie-a-phewas">Multiple exposures on single outcome (i.e., a “PheWAS”)<a class="anchor" aria-label="anchor" href="#multiple-exposures-on-single-outcome-ie-a-phewas"></a>
</h5>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_vars</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bmi"</span>,<span class="st">"ldl"</span>,<span class="st">"sbp"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/get_assoc.html">get_assoc</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x_vars</span>, y<span class="op">=</span><span class="st">"chd"</span>, z<span class="op">=</span><span class="st">"+age+sex"</span>, d<span class="op">=</span><span class="va">ukb</span>, model<span class="op">=</span><span class="st">"logistic"</span><span class="op">)</span></span>
<span><span class="co">#&gt; # A tibble: 3 x 11</span></span>
<span><span class="co">#&gt;   outcome exposure estimate std.error statistic p.value conf.low conf.high     n n_cases model   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;   &lt;int&gt; &lt;chr&gt;   </span></span>
<span><span class="co">#&gt; 1 chd     bmi         1.08    0.0113      6.97  3.1e-12    1.06       1.11  4692     324 logistic</span></span>
<span><span class="co">#&gt; 2 chd     ldl         0.980   0.0689     -0.300 7.6e- 1    0.856      1.12  4498     311 logistic</span></span>
<span><span class="co">#&gt; 3 chd     sbp         1.01    0.00333     3.53  4.2e- 4    1.01       1.02  4561     316 logistic</span></span></code></pre></div>
<p>Multiple exposures and outcomes can be provided simultaneously.</p>
</div>
<div class="section level5">
<h5 id="tidyverse-formatted-data-is-first-argument-get_assoc-can-be-on-the-right-side-of-other-dplyr-functions">Tidyverse formatted. Data is first argument. <code>get_assoc()</code> can be on the right-side of other <code>dplyr</code> functions<a class="anchor" aria-label="anchor" href="#tidyverse-formatted-data-is-first-argument-get_assoc-can-be-on-the-right-side-of-other-dplyr-functions"></a>
</h5>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res_all</span>     <span class="op">=</span> <span class="va">ukb</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="reference/get_assoc.html">get_assoc</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x_vars</span>, y<span class="op">=</span><span class="st">"chd"</span>, z<span class="op">=</span><span class="st">"+age+sex"</span>, model<span class="op">=</span><span class="st">"logistic"</span>, note<span class="op">=</span><span class="st">"All"</span><span class="op">)</span></span>
<span><span class="va">res_males</span>   <span class="op">=</span> <span class="va">ukb</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span><span class="op">==</span><span class="st">"Male"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="reference/get_assoc.html">get_assoc</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x_vars</span>, y<span class="op">=</span><span class="st">"chd"</span>, z<span class="op">=</span><span class="st">"+age"</span>, model<span class="op">=</span><span class="st">"logistic"</span>, note<span class="op">=</span><span class="st">"Males"</span><span class="op">)</span></span>
<span><span class="va">res_females</span> <span class="op">=</span> <span class="va">ukb</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span><span class="op">==</span><span class="st">"Female"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>                <span class="fu"><a href="reference/get_assoc.html">get_assoc</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x_vars</span>, y<span class="op">=</span><span class="st">"chd"</span>, z<span class="op">=</span><span class="st">"+age"</span>, model<span class="op">=</span><span class="st">"logistic"</span>, note<span class="op">=</span><span class="st">"Females"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">res</span> <span class="op">=</span> <span class="fu">list_rbind</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">res_all</span>, <span class="va">res_males</span>, <span class="va">res_females</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="data-transformation">Data Transformation<a class="anchor" aria-label="anchor" href="#data-transformation"></a>
</h2>
<div class="section level3">
<h3 id="carrec">carrec()<a class="anchor" aria-label="anchor" href="#carrec"></a>
</h3>
<p>From <a href="https://github.com/svmiller/stevemisc" class="external-link">Steve Miller’s package</a>: <code><a href="reference/carrec.html">carrec()</a></code> (phonetically: “car-wreck”) is a port of <code>car::recode()</code> to avoid clashes in the {car} package. This offers STATA-like recoding features for R.</p>
<p>For example, if a variable of interest is on a 1-10 scale and you want to code values 6 and above to be 1, and code values of 1-5 to be 0, you would do:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt; [1]  1  2  3  4  5  6  7  8  9 10</span></span>
<span></span>
<span><span class="fu"><a href="reference/carrec.html">carrec</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"1:5=0;6:10=1"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0 0 0 0 0 1 1 1 1 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="inv_norm">inv_norm()<a class="anchor" aria-label="anchor" href="#inv_norm"></a>
</h3>
<p>Inverse (quantile) normalise a quantitative trait (vector) i.e., transform to a normal distribution with mean=0 and sd=1</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_in</span> <span class="op">=</span> <span class="fu"><a href="reference/inv_norm.html">inv_norm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>x_in <span class="op">=</span> <span class="fu"><a href="reference/inv_norm.html">inv_norm</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="z_trans">z_trans()<a class="anchor" aria-label="anchor" href="#z_trans"></a>
</h3>
<p>Z-transform a quantitative trait (vector) i.e., convert to mean=0 and sd=1, maintaining original distribution</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x_z</span> <span class="op">=</span> <span class="fu"><a href="reference/z_trans.html">z_trans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span> <span class="op">=</span> <span class="va">df</span> <span class="op">|&gt;</span> <span class="fu">mutate</span><span class="op">(</span>x_z <span class="op">=</span> <span class="fu"><a href="reference/z_trans.html">z_trans</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="working-with-test-statistics">Working with test statistics<a class="anchor" aria-label="anchor" href="#working-with-test-statistics"></a>
</h2>
<div class="section level3">
<h3 id="get_se">get_se()<a class="anchor" aria-label="anchor" href="#get_se"></a>
</h3>
<p>Calculate Standard Error from Confidence Intervals.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lci</span> <span class="op">=</span> <span class="fl">0.1</span></span>
<span><span class="va">uci</span> <span class="op">=</span> <span class="fl">0.3</span></span>
<span></span>
<span><span class="co"># Default denominator is (1.96*2) equivalent to 95% confidence (p&lt;0.05)</span></span>
<span><span class="fu"><a href="reference/get_se.html">get_se</a></span><span class="op">(</span><span class="va">lci</span>, <span class="va">uci</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.05102041</span></span>
<span></span>
<span><span class="co"># custom denominator e.g., if CIs correspond to a p-value 5*10-8</span></span>
<span><span class="fu"><a href="reference/get_se.html">get_se</a></span><span class="op">(</span><span class="va">lci</span>, <span class="va">uci</span>, denominator<span class="op">=</span><span class="fu">lukesRlib</span><span class="fu">::</span><span class="fu"><a href="reference/get_z.html">get_z</a></span><span class="op">(</span><span class="fl">5e-8</span><span class="op">)</span><span class="op">*</span><span class="fl">2</span><span class="op">)</span>   </span>
<span><span class="co">#&gt;  [1] 0.01834421</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get_z">get_z()<a class="anchor" aria-label="anchor" href="#get_z"></a>
</h3>
<p>Return a Z-statistic from a given p-value</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> <span class="fl">1e-10</span></span>
<span><span class="fu"><a href="reference/get_z.html">get_z</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 6.466951</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get_p">get_p()<a class="anchor" aria-label="anchor" href="#get_p"></a>
</h3>
<p>Return a p-value from a z (or t) statistic</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">=</span> <span class="fl">10</span></span>
<span><span class="fu"><a href="reference/get_p.html">get_p</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 1.523971e-23</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get_p_extreme">get_p_extreme()<a class="anchor" aria-label="anchor" href="#get_p_extreme"></a>
</h3>
<p>Normally R will round numbers &lt; 1*10-324 to zero. This function returns the “extreme p-value” as a string. Provide a z (or t) statistic</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="fu"><a href="reference/get_p_extreme.html">get_p_extreme</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] "2.16e-545"</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get_p_neglog10">get_p_neglog10()<a class="anchor" aria-label="anchor" href="#get_p_neglog10"></a>
</h3>
<p>Returns the -log10 p-value. Provide a z (or t) statistic</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="fu"><a href="reference/get_p_neglog10.html">get_p_neglog10</a></span><span class="op">(</span><span class="va">z</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 544.6653</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="get_p_neglog10_n">get_p_neglog10_n()<a class="anchor" aria-label="anchor" href="#get_p_neglog10_n"></a>
</h3>
<p>Returns the -log10 p-value. Provide a z (or t) statistic and n (sample size)</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">z</span> <span class="op">=</span> <span class="fl">50</span></span>
<span><span class="va">n</span> <span class="op">=</span> <span class="fl">100000</span></span>
<span><span class="fu"><a href="reference/get_p_neglog10_n.html">get_p_neglog10_n</a></span><span class="op">(</span><span class="va">z</span>, <span class="va">n</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 537.9851</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="plotting-related">Plotting-related<a class="anchor" aria-label="anchor" href="#plotting-related"></a>
</h2>
<div class="section level3">
<h3 id="annotate_textp">annotate_textp()<a class="anchor" aria-label="anchor" href="#annotate_textp"></a>
</h3>
<p>Annotate a ggplot2 plot with text. Allows one to specify the relative position of the figure easily. Configurable margin, text and box justification. The added bonus in the following code is that you can specify which facet to annotate with something like <code>facets=data.frame(cat1='blue', cat2='tall')</code>.</p>
<p>Function originally by Rosen Matev (from <a href="https://stackoverflow.com/questions/22488563/ggplot2-annotate-layer-position-in-r" class="external-link uri">https://stackoverflow.com/questions/22488563/ggplot2-annotate-layer-position-in-r</a>)</p>
<p>To get it aligned nicely in the middle, it may also require adjusting <code>box_just</code> depending on plot width etc. Other options include <code>size</code> and <code>alpha</code></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">qplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/annotate_textp.html">annotate_textp</a></span><span class="op">(</span><span class="st">'Text annotation\nx=1, y=0, hjust=1'</span>, x<span class="op">=</span><span class="fl">1</span>, y<span class="op">=</span><span class="fl">0</span>, hjust<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">qplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/annotate_textp.html">annotate_textp</a></span><span class="op">(</span><span class="st">'Text annotation\nx=0.1, y=0.9, hjust=0'</span>, x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">1</span>, hjust<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">qplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/annotate_textp.html">annotate_textp</a></span><span class="op">(</span><span class="st">'Text annotation\nx = 0.5, y=0.5, hjust=0.5\nbox_just=c(0.5,0.5)'</span>, x<span class="op">=</span><span class="fl">0.5</span>, y<span class="op">=</span><span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">0.5</span>, box_just<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">qplot</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="reference/annotate_textp.html">annotate_textp</a></span><span class="op">(</span><span class="st">'Text annotation\nx = 0.5, y=0.5, hjust=0.5\nbox_just=c(0.5,0.5)\nsize=14, alpha=0.5'</span>, x<span class="op">=</span><span class="fl">0.5</span>, y<span class="op">=</span><span class="fl">0.5</span>, hjust<span class="op">=</span><span class="fl">0.5</span>, box_just<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>,<span class="fl">0.5</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">13</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img align="center" src="https://github.com/lukepilling/lukesRlib/raw/master/images/annotate_textp.png"></p>
</div>
<div class="section level3">
<h3 id="theme_minimal_modified">theme_minimal_modified()<a class="anchor" aria-label="anchor" href="#theme_minimal_modified"></a>
</h3>
<p>Nice modification to ggplot’s <code>theme_minimal</code> by Albert Rapp (<a href="https://alberts-newsletter.beehiiv.com/p/ggplot-theme" class="external-link uri">https://alberts-newsletter.beehiiv.com/p/ggplot-theme</a>)</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="va">penguins</span> <span class="op">&lt;-</span> <span class="fu">palmerpenguins</span><span class="fu">::</span><span class="va"><a href="https://allisonhorst.github.io/palmerpenguins/reference/penguins.html" class="external-link">penguins</a></span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">basic_plot</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">body_mass_g</span>, fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fl">21</span>, size <span class="op">=</span> <span class="fl">5</span>, alpha <span class="op">=</span> <span class="fl">0.85</span>, color <span class="op">=</span> <span class="st">'grey10'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">'Bill length (in mm)'</span>,</span>
<span>    y <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">'Species'</span>,</span>
<span>    title <span class="op">=</span> <span class="st">'Penguins from the Palmer Archipelago'</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">'Penguin weights (in g)'</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">'Data: {palmerpenguins} R package'</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">basic_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span>, base_family <span class="op">=</span> <span class="st">'Source Sans Pro'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Adelie'</span><span class="op">=</span> <span class="st">'#da2c38'</span>, <span class="st">'Chinstrap'</span><span class="op">=</span> <span class="st">'#FED18C'</span>, <span class="st">'Gentoo'</span><span class="op">=</span> <span class="st">'#30C5FF'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># scale_fill_manual(values = thematic::okabe_ito(6)) +</span></span>
<span>  <span class="fu"><a href="reference/theme_minimal_modified.html">theme_minimal_modified</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img align="center" src="https://github.com/lukepilling/lukesRlib/raw/master/images/theme_minimal_modified.png" width="600"></p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/lukepilling/lukesRlib/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/lukepilling/lukesRlib/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing lukesRlib</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://lukepilling.github.io" class="external-link">Luke Pilling</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3332-8454" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/lukepilling/lukesRlib" class="external-link"><img src="https://img.shields.io/badge/version-0.2.5.9000-informational.svg"></a></li>
<li><a href="https://github.com/lukepilling/lukesRlib/commits/master" class="external-link"><img src="https://img.shields.io/github/last-commit/lukepilling/lukesRlib.svg"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange"></a></li>
<li><a href="https://zenodo.org/badge/latestdoi/590063045" class="external-link"><img src="https://zenodo.org/badge/590063045.svg" alt="DOI"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://lukepilling.github.io" class="external-link">Luke Pilling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
