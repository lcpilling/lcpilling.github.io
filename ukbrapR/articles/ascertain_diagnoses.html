<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="Learn how to ascertain diagnoses in UK Biobank Electronic Medical Records.
">
<title>Ascertaining UK Biobank diagnoses • ukbrapR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ascertaining UK Biobank diagnoses">
<meta property="og:description" content="Learn how to ascertain diagnoses in UK Biobank Electronic Medical Records.
">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ukbrapR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/ascertain_diagnoses.html">Ascertaining UK Biobank diagnoses</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lcpilling/ukbrapR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ascertaining UK Biobank diagnoses</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lcpilling/ukbrapR/blob/HEAD/vignettes/ascertain_diagnoses.Rmd" class="external-link"><code>vignettes/ascertain_diagnoses.Rmd</code></a></small>
      <div class="d-none name"><code>ascertain_diagnoses.Rmd</code></div>
    </div>

    
    
<p>The goal of ukbrapR (phonetically: “U-K-B-wrapper”’“) is to make
ascertaining diagnoses in UK Biobank Electronic Medical Records (EMR)
simple and reproducible. It takes just a couple of minutes to go from a
list of diagnostic codes, to variables containing the”date first
diagnosed, any source.”</p>
<p>This is simplest is you are using the UK Biobank Research Analysis
Platform (RAP) on DNAnexus, but the functions work just as well using
local servers if you have the raw data saved as text files.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># First, load the package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lcpilling.github.io/ukbrapR">ukbrapR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="list-of-diagnostic-codes">List of diagnostic codes<a class="anchor" aria-label="anchor" href="#list-of-diagnostic-codes"></a>
</h2>
<p>The outputted data is only ever as good as the diagnostic codes you
provide. The UK Biobank has a number of quirks to be aware of. If you’re
not already familiar with the documentation (<a href="https://biobank.ctsu.ox.ac.uk/crystal/label.cgi?id=100091" class="external-link uri">https://biobank.ctsu.ox.ac.uk/crystal/label.cgi?id=100091</a>)
this is recommended.</p>
<p>Create a data frame containing the diagnostic codes. At minimum it
needs two variables: <code>codes</code> and <code>vocab_id</code> but a
third is recommended <code>condition</code>. Here, we will use codes for
haemochromatosis.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">codes_df_hh</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    condition vocab_id  code</span></span>
<span><span class="co">## 1         hh    ICD10 E83.1</span></span>
<span><span class="co">## 2         hh    Read2 126A.</span></span>
<span><span class="co">## 3         hh    Read2 4L41.</span></span>
<span><span class="co">## 4         hh    Read2 677C0</span></span>
<span><span class="co">## 5         hh    Read2 C350.</span></span>
<span><span class="co">## 6         hh    Read2 C3500</span></span>
<span><span class="co">## 7         hh     CTV3 C3500</span></span>
<span><span class="co">## 8         hh     CTV3 X40QQ</span></span>
<span><span class="co">## 9         hh     CTV3 XaIyI</span></span>
<span><span class="co">## 10        hh     CTV3 XaIyx</span></span></code></pre>
<p>This data frame can contain codes for multiple conditions if desired.
Indicate where the codes belong using the <code>condition</code>
field.</p>
</div>
<div class="section level2">
<h2 id="ascertain-emr-data-for-all-codes-in-codes_df">Ascertain EMR data for all codes in <code>codes_df</code><a class="anchor" aria-label="anchor" href="#ascertain-emr-data-for-all-codes-in-codes_df"></a>
</h2>
<p>This function searches the GP, HES, and mortality data for all codes
in the provided data frame.</p>
<p>The “long” data is returned as a list containing the subset of
<code>gp_clinical</code>, <code>hesin_diag</code> and
<code>death_cause</code> with matched codes.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># If running on the RAP:</span></span>
<span><span class="va">diagnosis_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_emr.html">get_emr</a></span><span class="op">(</span><span class="va">codes_df_hh</span><span class="op">)</span></span>
<span><span class="co">#&gt; 7 ICD10 codes, 40 Read2 codes, 37 CTV3 codes </span></span>
<span><span class="co">#&gt; 298.18 sec elapsed</span></span></code></pre></div>
<p>If running on your own server, provide paths to the files. Note: if
you are in my group and using servers <code>indy</code>,
<code>shapter</code> or <code>snow</code> you do not need to provide the
paths</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnosis_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_emr.html">get_emr</a></span><span class="op">(</span><span class="va">codes_df_hh</span>, file_paths<span class="op">=</span><span class="va">paths</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="determine-the-date-first-diagnosed">Determine the date first diagnosed<a class="anchor" aria-label="anchor" href="#determine-the-date-first-diagnosed"></a>
</h2>
<p>Identify the date first diagnosed for each participant from any of
the “long” datasets ascertained above.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for each participant, get Date First diagnosed with the condition</span></span>
<span><span class="va">diagnosis_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_df.html">get_df</a></span><span class="op">(</span><span class="va">diagnosis_list</span><span class="op">)</span></span>
<span><span class="co">#&gt; takes &lt;1 second</span></span></code></pre></div>
<p>By default the <code>date first</code> fields is simply “df” - you
can add a variable prefix like:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diagnosis_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_df.html">get_df</a></span><span class="op">(</span><span class="va">diagnosis_list</span>, prefix<span class="op">=</span><span class="st">"hh"</span><span class="op">)</span></span></code></pre></div>
<p>The function produces 5 variables for each condition. For
haemochromatosis, as ran above, these are:</p>
<table class="table">
<thead><tr class="header">
<th>Field</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>hh_gp_df</td>
<td>Date first diagnosed in GP data</td>
</tr>
<tr class="even">
<td>hh_hes_df</td>
<td>Date first diagnosed in HES data</td>
</tr>
<tr class="odd">
<td>hh_death_df</td>
<td>Date first diagnosed in death data</td>
</tr>
<tr class="even">
<td>hh_df</td>
<td>Date first diagnosed from any source</td>
</tr>
<tr class="odd">
<td>hh_src</td>
<td>Source of combined date first</td>
</tr>
</tbody>
</table>
<div class="section level3">
<h3 id="ascertaining-multiple-conditions-at-once">Ascertaining multiple conditions at once<a class="anchor" aria-label="anchor" href="#ascertaining-multiple-conditions-at-once"></a>
</h3>
<p>By default <code><a href="../reference/get_df.html">get_df()</a></code> will use all provided data. If you
searched for codes for multiple conditions at once and want to identify
the date first for each one, indicate this using
<code>group_by="condition"</code> (assuming the field was called
“condition”).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine haemochromatosis and CKD codes together</span></span>
<span><span class="va">codes_df_combined</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">codes_df_hh</span>, <span class="va">codes_df_ckd</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get diagnosis data - returns list of data frames (one per source)</span></span>
<span><span class="va">diagnosis_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_emr.html">get_emr</a></span><span class="op">(</span><span class="va">codes_df_combined</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for each participant, get Date First diagnosed with the condition</span></span>
<span><span class="va">diagnosis_df</span> <span class="op">=</span> <span class="fu"><a href="../reference/get_df.html">get_df</a></span><span class="op">(</span><span class="va">diagnosis_list</span>, group_by<span class="op">=</span><span class="st">"condition"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://lcpilling.github.io" class="external-link">Luke Pilling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
