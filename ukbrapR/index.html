<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="R functions to use in the UK Biobank Research Analysis Platform (RAP). Not comprehensive, but designed to make some working on the RAP easier. Some shamelessly borrowed from other packages and the internet generally.">
<title>R functions to use in the UK Biobank Research Analysis Platform (RAP) • ukbrapR</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="R functions to use in the UK Biobank Research Analysis Platform (RAP)">
<meta property="og:description" content="R functions to use in the UK Biobank Research Analysis Platform (RAP). Not comprehensive, but designed to make some working on the RAP easier. Some shamelessly borrowed from other packages and the internet generally.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ukbrapR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lukepilling/ukbrapR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="ukbrapr">ukbrapR<a class="anchor" aria-label="anchor" href="#ukbrapr"></a>
</h1></div>
<p>R functions to use in the UK Biobank Research Analysis Platform (RAP).</p>
<!-- badges: start -->

<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>This will only work on DNAnexus (<a href="https://ukbiobank.dnanexus.com" class="external-link uri">https://ukbiobank.dnanexus.com</a>) in an approved UK Biobank project.</p>
<p>In tools, create a JupyterLab environment on a Spark Cluster. Start an R session and install this package. This will install the necessary dependencies for interacting with the Python environment, Apache Spark, and the Arrow C++ library.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://remotes.r-lib.org" class="external-link">remotes</a></span><span class="op">)</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"remotes"</span><span class="op">)</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"lukepilling/ukbrapR"</span><span class="op">)</span></span>
<span>  <span class="co"># this takes a few minutes to build the dependencies</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="get-phenotypes-on-the-rap">Get phenotypes on the RAP<a class="anchor" aria-label="anchor" href="#get-phenotypes-on-the-rap"></a>
</h2>
<p>My main motivation was to create a wrapper function in R to extract phenotype variables from the Spark distributed database functions (like SQL). The primary function is <code><a href="reference/get_rap_phenos.html">get_rap_phenos()</a></code> which mostly contains code from the UK Biobank DNAnexus team <a href="https://github.com/UK-Biobank/UKB-RAP-Notebooks/blob/main/NBs_Prelim/105_export_participant_data_to_r.ipynb" class="external-link uri">https://github.com/UK-Biobank/UKB-RAP-Notebooks/blob/main/NBs_Prelim/105_export_participant_data_to_r.ipynb</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://lukepilling.github.io/ukbrapR" class="external-link">ukbrapR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get phenotype data (participant ID, sex, and baseline age)</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_rap_phenos.html">get_rap_phenos</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"eid"</span>,<span class="st">"p31"</span>,<span class="st">"p21003_i0"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># takes a few minutes to complete interactions with Apache Spark etc.</span></span>
<span></span>
<span><span class="co"># overview of data</span></span>
<span><span class="fu">skimr</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/skimr/reference/skim.html" class="external-link">skim</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; ── Data Summary ────────────────────────</span></span>
<span><span class="co">#&gt;                            Values</span></span>
<span><span class="co">#&gt; Name                       df    </span></span>
<span><span class="co">#&gt; Number of rows             502364</span></span>
<span><span class="co">#&gt; Number of columns          3     </span></span>
<span><span class="co">#&gt; _______________________          </span></span>
<span><span class="co">#&gt; Column type frequency:           </span></span>
<span><span class="co">#&gt;   character                2     </span></span>
<span><span class="co">#&gt;   numeric                  1     </span></span>
<span><span class="co">#&gt; ________________________         </span></span>
<span><span class="co">#&gt; Group variables            None  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Variable type: character ────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   skim_variable n_missing complete_rate min max empty n_unique whitespace</span></span>
<span><span class="co">#&gt; 1 eid                   0             1   7   7     0   502364          0</span></span>
<span><span class="co">#&gt; 2 p31                   0             1   4   6     0        2          0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; ── Variable type: numeric ──────────────────────────────────────────────────────</span></span>
<span><span class="co">#&gt;   skim_variable n_missing complete_rate mean   sd p0 p25 p50 p75 p100 hist </span></span>
<span><span class="co">#&gt; 1 p21003_i0             0             1 56.5 8.09 37  50  58  63   73 ▂▅▆▇▃</span></span>
<span></span>
<span><span class="co"># save to file on the RAP worker node</span></span>
<span><span class="fu">write_tsv</span><span class="op">(</span><span class="va">df</span>, <span class="st">"ukb14631.data_output.20231026.txt.gz"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="upload-back-to-the-rap">Upload back to the RAP<a class="anchor" aria-label="anchor" href="#upload-back-to-the-rap"></a>
</h2>
<p>A wrapper to quickly upload a file from the worker node to the RAP space.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># uploads to current working directory</span></span>
<span><span class="fu"><a href="reference/upload_to_rap.html">upload_to_rap</a></span><span class="op">(</span><span class="st">"ukb14631.data_output.20231026.txt.gz"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># uploads to directory "extracts"</span></span>
<span><span class="fu"><a href="reference/upload_to_rap.html">upload_to_rap</a></span><span class="op">(</span><span class="st">"ukb14631.data_output.20231026.txt.gz"</span>, dir<span class="op">=</span><span class="st">"extracts/"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/lukepilling/ukbrapR/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/lukepilling/ukbrapR/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ukbrapR</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://lukepilling.github.io" class="external-link">Luke Pilling</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-3332-8454" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/lukepilling/ukbrapR" class="external-link"><img src="https://img.shields.io/badge/version-0.0.1-informational.svg"></a></li>
<li><a href="https://github.com/lukepilling/ukbrapR/commits/master" class="external-link"><img src="https://img.shields.io/github/last-commit/lukepilling/ukbrapR.svg"></a></li>
<li><a href="https://www.tidyverse.org/lifecycle/#experimental" class="external-link"><img src="https://img.shields.io/badge/lifecycle-experimental-orange"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://lukepilling.github.io" class="external-link">Luke Pilling</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
